<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>e-Ink Control Panel</title>
    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 font-sans p-8">
    <div id="app" class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow-md">
      <h1 class="text-2xl font-bold mb-4">Upload Image to e-Ink Display</h1>
      <input
        type="file"
        @change="onFileChange"
        class="mb-4 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-emerald-50 file:text-emerald-700 hover:file:bg-emerald-100"
      />
      <img
        v-if="previewUrl"
        :src="previewUrl"
        alt="Preview"
        class="max-w-full mb-4 rounded-md border"
      />
      <button
        @click="uploadImage"
        :disabled="!selectedFile || loading"
        class="bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2 px-4 rounded disabled:opacity-50"
      >
        <span v-if="loading">Uploading...</span>
        <span v-else>Upload</span>
      </button>

      <!-- Toast Notification -->
      <transition name="fade">
        <div
          v-if="toastMessage"
          :class="['mt-4 px-4 py-2 rounded-md text-white', toastSuccess ? 'bg-emerald-500' : 'bg-red-500']"
        >
          {{ toastMessage }}
        </div>
      </transition>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            selectedFile: null,
            previewUrl: null,
            toastMessage: "",
            toastSuccess: true,
            loading: false,
          };
        },
        methods: {
          onFileChange(event) {
            const file = event.target.files[0];
            if (file) {
              this.selectedFile = file;
              this.previewUrl = URL.createObjectURL(file);
            } else {
              this.previewUrl = null;
              this.selectedFile = null;
            }
          },
          async uploadImage() {
            if (!this.selectedFile) return;

            const formData = new FormData();
            formData.append("image", this.selectedFile);

            this.loading = true;
            try {
              const response = await axios.post(
                "http://192.168.1.111:5000/api/upload-image",
                formData,
                {
                  headers: {
                    "Content-Type": "multipart/form-data",
                  },
                }
              );
              console.log(response.data);
              this.showToast("Upload successful!", true);
            } catch (error) {
              console.error(error);
              this.showToast("Upload failed.", false);
            } finally {
              this.loading = false;
            }
          },
          showToast(message, success = true) {
            this.toastMessage = message;
            this.toastSuccess = success;
            setTimeout(() => {
              this.toastMessage = "";
            }, 3000);
          },
        },
      }).mount("#app");
    </script>

    <style>
      .fade-enter-active,
      .fade-leave-active {
        transition: opacity 0.5s;
      }
      .fade-enter-from,
      .fade-leave-to {
        opacity: 0;
      }
    </style>
  </body>
</html>
